<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="org.forbes.dal.mapper.ext.SysProductExtMapper" >
    <!--总后台商品分页-->
    <resultMap id="sysResultMap" type="org.forbes.comm.vo.ProductSysPageVo">
        <!-- 创建时间 -->
        <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
        <!-- 分类id -->
        <result column="classify_id" property="classifyId" jdbcType="BIGINT" />
        <!-- 库存 -->
        <result column="stock" property="stock" jdbcType="VARCHAR" />
        <!-- 单价 -->
        <result column="price" property="price" jdbcType="DECIMAL" />
        <!-- 商品名称 -->
        <result column="productName" property="productName" jdbcType="VARCHAR" />
        <!-- 1上架2未上架3待审核4审核失败 -->
        <result column="state" property="state" jdbcType="VARCHAR" />
        <!-- 商品编码 -->
        <result column="pro_sn" property="proSn" jdbcType="VARCHAR" />

        <association property="productAttachVo" javaType="org.forbes.comm.vo.ProductAttachVo">
            <!-- 数据ID -->
            <result column="data_id" property="dataId" jdbcType="BIGINT" />
            <!-- 排序 -->
            <result column="orders_sort" property="ordersSort" jdbcType="INTEGER" />
            <!-- 后缀 -->
            <result column="suffix" property="suffix" jdbcType="VARCHAR" />
            <!-- 中文名称 -->
            <result column="cn_name" property="cnName" jdbcType="VARCHAR" />
            <result column="en_name" property="enName" jdbcType="VARCHAR" />
            <!-- 文件地址 -->
            <result column="file_path" property="filePath" jdbcType="VARCHAR" />
            <!-- 0-大图，1-小图，3-中图 -->
            <result column="type" property="type" jdbcType="VARCHAR" />
        </association>
        <association property="productClassifyVo" javaType="org.forbes.comm.vo.ProductClassifyVo">
            <result column="name" property="name" jdbcType="VARCHAR" />
        </association>
    </resultMap>
    <!--总后台多条件分页查询商品-->
    <select id="sysPage" parameterType="org.forbes.comm.model.ProductPageDto" resultMap="sysResultMap">
        SELECT
        fpc.name,
        fpa.data_id,
        fpa.orders_sort,
        fpa.suffix,
        fpa.cn_name,
        fpa.en_name,
        fpa.file_path,
        fpa.type,
        fp.create_time,
        fp.name AS productName,
        fp.pro_sn,
        fp.price,
        fp.stock,
        fp.state
        FROM
        f_product AS fp
        LEFT JOIN f_product_attach AS fpa ON fpa.data_id = fp.id
        LEFT JOIN f_product_classify AS fpc ON fpc.id = fp.classify_id
        <where>
            <if test="productPageDto.state != null and productPageDto.state != '' and productPageDto.state != 'null'">
                AND fp.state=#{productPageDto.state,jdbcType=VARCHAR}
            </if>
            <if test="productPageDto.proSn != null and productPageDto.proSn != '' and productPageDto.proSn != 'null'">
                AND fp.pro_sn=#{productPageDto.proSn,jdbcType=VARCHAR}
            </if>
        </where>
    </select>

    <select id="detail" parameterType="long" resultMap="sysResultMap">
         SELECT
        fpc.name,
        fpa.data_id,
        fpa.orders_sort,
        fpa.suffix,
        fpa.cn_name,
        fpa.en_name,
        fpa.file_path,
        fpa.type,
        fp.create_time,
        fp.name AS productName,
        fp.pro_sn,
        fp.price,
        fp.stock,
        fp.state
        FROM
        f_product AS fp
        LEFT JOIN f_product_attach AS fpa ON fpa.data_id = fp.id
        LEFT JOIN f_product_classify AS fpc ON fpc.id = fp.classify_id
        WHERE fp.id=#{id,jdbcType=BIGINT}
    </select>
</mapper>